name: Deploy to Production

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Target environment'
        required: true
        type: choice
        options:
          - staging
          - production

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Deploy to Kubernetes
        run: |
          echo "Deploying to ${{ github.event.inputs.environment }}"
          kubectl apply -f k8s/${{ github.event.inputs.environment }}/
      
      - name: Notify Datadog
        run: |
          curl -X POST "https://api.datadoghq.com/api/v1/events" \
            -H "DD-API-KEY: ${{ secrets.DATADOG_API_KEY }}" \
            -d @- << EOF
          {
            "title": "Deployment: artist-lookup",
            "text": "Deployed to ${{ github.event.inputs.environment }}",
            "tags": ["service:artist-lookup", "env:${{ github.event.inputs.environment }}"]
          }
          EOF

